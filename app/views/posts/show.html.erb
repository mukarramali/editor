<h1><%= @post.title %></h1>

<textarea id="post_area" data-post-channel="post" data-post-id="<%= @post.id %>"><%= @post.content %></textarea>

<%= link_to 'Back', posts_path %>

<script>
  var pre_val = "";
  var new_val = "";
  $('#post_area').bind('input propertychange', function(){
    new_val = $(this).val();
    if(new_val.localeCompare(pre_val) != 0)
    {
      pre_val = new_val;
      push();
    }
  });

  function push(){
    post_id = $('#post_area').data("post-id");
    $.ajax({
    url: '/post_update',
    data: {
          'post' : $('#post_area').val(),
          'post_id' : $('#post_area').data("post-id")
          },
      type: 'post',
      dataType: 'json',
      success: function(data){
        if(data['status'] != true)
          setTimeout(function(){push()}, 5000);
      },
      error: function(xhr, status, error) {
        var err = JSON.parse(xhr.responseText);
        console.log(err.Message);
        setTimeout(function(){push()}, 5000);
      }
    });
  }

    // CREATING CODEMIRROR EDITOR
  var cEditor = CodeMirror.fromTextArea(document.getElementById("post_area"), {
    mode: 'ruby',
    lineNumbers: true,
    lineWrapping: true,
    styleActiveLine: true,
    styleSelectedText: true,
    autoCloseBrackets: true,
    matchBrackets: true,
    foldGutter: true,
    lint: false,
    keyMap: 'sublime',
    gutters: ['CodeMirror-linenumbers', 'CodeMirror-foldgutter', 'CodeMirror-lint-markers'],
    extraKeys: {
      'Ctrl-Space': 'autocomplete',
      'Ctrl-Q': function(cm){ cm.foldCode(cm.getCursor()); }
    },
    theme: 'material',
    indentUnit: 2
  });

</script>